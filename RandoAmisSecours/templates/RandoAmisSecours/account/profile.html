{% extends 'RandoAmisSecours/base.html' %}
{% load humanize %}
{% load i18n %}

{% block title %}{% trans "Profile" %}{% endblock %}

{% block breadcrumb %}
  <li><a href="{% url 'index' %}">{% trans "Home" %}</a> <span class="divider">/</span></li>
  <li class="active">{% trans "Account" %}</li>
{% endblock %}

{% block body %}
<div class="page-header">
  <h2>{% trans "My profile" %}</h2>
</div>

<div class="row">
  {% if messages %}
  <div class="span12">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags|default:'error' }}">
      <button type="button" class="close" data-dismiss="alert"><i class="icon-remove"></i></button>
      <strong>{{ message.tags|default:'error'|capfirst }}:</strong> {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="span12">
    {% url 'friends.search' as URL %}
    <h3>{% trans "Friends" %} <a class="btn btn-info btn-mini" href="{% url 'friends.search' %}"><i class="icon-search icon-white"></i> {% trans "search" %}</a></h3>
    <div class="tabbable">
      <ul class="nav nav-tabs">
        <li class="active"><a href="#friends" data-toggle="tab">{% trans "Friends" %}</a></li>
        <li><a href="#received" data-toggle="tab">{% trans "Received" %}{% if friend_requests %} <span class="badge">{{ friend_requests.count }}</span>{% endif %}</a></li>
        <li><a href="#sent" data-toggle="tab">{% trans "Sent" %}{% if friend_requests_sent %} <span class="badge">{{ friend_requests_sent.count }}</span>{% endif %}</a></li>
      </ul>
    </div>
    <div class="tab-content">
      <div class="tab-pane active" id="friends">
        {% if user.profile.friends.all %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>{% trans "Name" %}</th>
              <th>{% trans "Phone number" %}</th>
              <th></th>
            </tr>
          </thead>
          {% for friend in user.profile.friends.all %}
          <tr>
            <td>{{ friend.user.get_full_name }}</td>
            <td>{% if friend.phone_number %}<a href="tel:{{ friend.phone_number }}">{{ friend.phone_number }}</a>{% else %}?{% endif %}</td>
            <td><a href="#deleteFriendModal{{ friend.user.pk }}" role="button" class="btn btn-mini btn-danger" title="{% trans "delete" %}" data-toggle="modal"><i class="icon-trash"></i></a>
            <div id="deleteFriendModal{{ friend.user.pk }}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="deleteFriendModal{{ friend.user.pk }}Label" aria-hidden="true">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
                <h3 id="deleteFriendModal{{ friend.user.pk }}">{% trans "Remove friend from list" %}</h3>
              </div>
              <div class="modal-body">
                <p>{% blocktrans with friend.user.get_full_name as name %}Are you sure you want to remove «{{ name }}» from your friends?{% endblocktrans %}</p>
              </div>
              <div class="modal-footer">
                <button class="btn" data-dismiss="modal" arai-hidden="true">{% trans "Cancel" %}</button>
                <a href="{% url 'friends.delete' friend.user.pk %}" class="btn btn-danger">{% trans "Delete" %}</a>
              </div>
            </div></td>
          </tr>
          {% endfor %}
        </table>
        {% else %}
        <p>{% trans "You don't have friends here for the moment." %}</p>
        {% endif %}
      </div>
      <div class="tab-pane" id="received">
        {% if friend_requests %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>{% trans "Name" %}</th>
              <th>{% trans "Received" %}</th>
              <th>{% trans "Action" %}</th>
            </tr>
          </thead>
          {% for f_r in friend_requests %}
          <tr>
            <td>{{ f_r.user.get_full_name }}</td>
            <td>{{ f_r.creation|timesince }}</td>
            <td><a href="{% url 'friends.accept' f_r.pk %}" class="btn btn-mini btn-success" title="{% trans "Accept" %}"><i class="icon-ok-sign"></i></a><a href="{% url 'friends.refuse' f_r.pk %}" class="btn btn-mini btn-danger" title="{% trans "Refuse" %}"><i class="icon-trash"></i></a></td>
          </tr>
          {% endfor %}
        </table>
        {% else %}
        <p>{% trans "Not any request received" %}</p>
        {% endif %}
      </div>
      <div class="tab-pane" id="sent">
        {% if friend_requests_sent %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>{% trans "Name" %}</th>
              <th>{% trans "Sent" %}</th>
              <th>{% trans "Action" %}</th>
            </tr>
          </thead>
          {% for f_r in friend_requests_sent %}
          <tr>
            <td>{{ f_r.to.get_full_name }}</td>
            <td>{{ f_r.creation|timesince }}</td>
            <td><a href="{% url 'friends.cancel' f_r.pk %}" class="btn btn-mini btn-danger" title="{% trans "Cancel" %}"><i class="icon-trash"></i></a></td>
          </tr>
          {% endfor %}
        </table>
        {% else %}
        <p>{% trans "Not any request sent" %}</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="span12">
    {% url 'accounts.profile.update' as URL %}
    <h3>{% trans "Information" %} <a class="btn btn-info btn-mini" href="{% url 'accounts.profile.update' %}"><i class="icon-wrench icon-white"></i> {% trans "update" %}</a></h3>
    <div class="row">
      <div class="span6">
        <dl class="dl-horizontal">
          <dt>{% trans "Name" %}</dt>
          <dd>{{ user.get_full_name }}</dd>
          <dt>{% trans "email" %}</dt>
          <dd>{{ user.email }}</dd>
          <dt>{% trans "Phone number" %}</dt>
          <dd>{{ user.profile.phone_number|default:"?" }}</dd>
          <dt>{% trans "Password" %}</dt>
          <dd><a href="{% url 'accounts.password_change' %}"><i class="icon-lock"></i> {% trans "update" %}</a></dd>
        </dl>
      </div>
      <div class="span6">
        <dl class="dl-horizontal">
          <dt>{% trans "Language" %}</dt>
          {% if user.profile.get_language_display %}
          <dd>{% trans user.profile.get_language_display %}</dd>
          {% else %}
          <dd>{% trans "undefined" %}</dd>
          {% endif %}
        </dl>
      </div>
    </div>
  </div>
  <div class="span12">
    <h3>{% trans "Deleting my account" %}</h3>
    <p>{% trans "If you want to remove your account, just click on the folowing button. Be careful as it will permanently remove all your outings and personal data." %}</p>
    <a class="btn btn-danger" href="{% url 'accounts.delete' %}">{% trans "Deleting my account" %}</a>
  </div>
</div>
{% endblock %}
